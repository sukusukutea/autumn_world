<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Áßã„ÅÆ‰∏ñÁïåÂÆåÊàêÁô∫Ë°®</title>
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>
  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
  <%= javascript_importmap_tags %>
  
  <!-- html2canvas „É©„Ç§„Éñ„É©„É™ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>

<body class="game-page" data-controller="complete">
  <!-- Êó¢Â≠ò„ÅÆgame-page„ÇØ„É©„Çπ„Çí‰ΩøÁî® -->
  
  <div class="complete-container">
    
    <!-- ÂÆåÊàê„Åä„ÇÅ„Åß„Å®„ÅÜ„É°„ÉÉ„Çª„Éº„Ç∏ -->
    <div class="completion-screen">
      <div class="completion-header">
        <h1>üçÇ Áßã„ÅÆ‰∏ñÁïå ÂÆåÊàêÁô∫Ë°®ÔºÅ</h1>
        <p>„ÅÇ„Å™„Åü„ÅåÊèè„ÅÑ„ÅüÁßã„ÅÆÈ¢®ÊôØ„ÅÆÂÆåÊàêÂ∫¶„Çí„ÅäË¶ã„Åõ„Åó„Åæ„Åô‚ú®</p>
      </div>

      <div class="achievement-showcase">
        <div class="achievement-circle" style="border-color: <%= @achievement_level[:color] %>;">
        <div class="percentage-display">
          <span class="percentage-number"><%= @achievement_percentage %></span>
          <span class="percentage-symbol">%</span>
        </div>
        <div class="achievement-subtitle">ÂÆåÊàêÂ∫¶</div>
      </div>

      <div class="achievement-badge">
        <div class="level-icon"><%= @achievement_level[:level] %></div>
        <div class="level-info">
          <h2 class="level-title"><%= @achievement_level[:title] %></h2>
          <p class="level-message"><%= @achievement_level[:message] %></p>
        </div>
      </div>
    </div>

    <!-- ‰ΩøÁî®„Åó„ÅüË®ÄËëâ„ÅÆË°®Á§∫ -->
    <div class="used-words" style="margin-bottom: 30px;">
      <h3 style="font-size: 1.5rem; margin-bottom: 15px;">‰ΩøÁî®„Åó„ÅüË®ÄËëâ:</h3>
      <div class="word-tags" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px;">
        <% @used_words.each do |word| %>
        <span class="word-tag" style="background: rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 20px; font-weight: bold;"><%= word %></span>
        <% end %>
      </div>
    </div>
    
    <!-- „Ç≠„É£„Éó„ÉÅ„É£ÂØæË±°„Ç®„É™„Ç¢ÔºàÊó¢Â≠ò„ÅÆgame-field„ÇØ„É©„Çπ„Çí‰ΩøÁî®Ôºâ -->
    <div class="capture-area" data-complete-target="captureArea">
      <div class="game-field">
        
        <!-- Âü∫Êú¨„É¨„Ç§„É§„ÉºÔºàÊó¢Â≠ò„ÅÆlayer„ÇØ„É©„Çπ„Çí‰ΩøÁî®Ôºâ -->
        <div class="layer sky-layer">
          <% if @landscape_state['sky_color_autumn'] %>
            <img class="layer-image" src="<%= asset_path('autumn/sky_autumn.png') %>" alt="Á©∫">
          <% else %>
            <img class="layer-image" src="<%= asset_path('summer/sky_summer.png') %>" alt="Á©∫">
          <% end %>
        </div>
        
        <div class="layer cloud-layer">
          <% if @landscape_state['cloud_style_autumn'] %>
          <img class="layer-image" src="<%= asset_path('autumn/cloud_autumn.png') %>" alt="Èõ≤">
          <% else %>
            <img class="layer-image" src="<%= asset_path('summer/cloud_summer.png') %>" alt="Èõ≤">
          <% end %>
        </div>
        
        <div class="layer mountain-layer">
          <% if @landscape_state['mountain_color_autumn'] %>
          <img class="layer-image" src="<%= asset_path('autumn/mountain_autumn.png') %>" alt="Â±±">
          <% else %>
            <img class="layer-image" src="<%= asset_path('summer/mountain_summer.png') %>" alt="Â±±">
          <% end %>
        </div>
        
        <div class="layer ground-layer">
          <% if @landscape_state['ground_color_autumn'] %>
          <img class="layer-image" src="<%= asset_path('autumn/ground_autumn.png') %>" alt="Âú∞Èù¢">
          <% else %>
            <img class="layer-image" src="<%= asset_path('summer/ground_summer.png') %>" alt="Âú∞Èù¢">
          <% end %>
        </div>
        
        <div class="layer trees-layer">
          <% if @landscape_state['trees_color_autumn'] %>
          <img class="layer-image" src="<%= asset_path('autumn/trees_autumn.png') %>" alt="Êú®">
          <% else %>
            <img class="layer-image" src="<%= asset_path('summer/trees_summer.png') %>" alt="Êú®">
          <% end %>
        </div>

        <div class="layer grandma-layer">
          <% if @landscape_state['grandma_style_autumn'] %>
          <img class="layer-image" src="<%= asset_path('autumn/grandma_autumn.png') %>" alt="„Åä„Å∞„ÅÇ„Å°„ÇÉ„Çì">
          <% else %>
            <img class="layer-image" src="<%= asset_path('summer/grandma_summer.png') %>" alt="„Åä„Å∞„ÅÇ„Å°„ÇÉ„Çì">
          <% end %>
        </div>
        
        <!-- Êù°‰ª∂‰ªò„Åç„É¨„Ç§„É§„ÉºÔºàlandscape_state„Å´Âü∫„Å•„ÅÑ„Å¶Ë°®Á§∫Ôºâ -->
        <% if @landscape_state['maple'] %>
          <div class="layer maple-layer" style="display: block;">
            <img class="layer-image" src="<%= asset_path('autumn/maple_autumn.png') %>" alt="„Ç´„Ç®„Éá">
          </div>
        <% end %>
        
        <% if @landscape_state['ginkgo'] %>
          <div class="layer ginkgo-layer" style="display: block;">
            <img class="layer-image" src="<%= asset_path('autumn/ginkgo_autumn.png') %>" alt="„Ç§„ÉÅ„Éß„Ç¶">
          </div>
        <% end %>
        
        <% if @landscape_state['grass'] %>
          <div class="layer grass-layer" style="display: block;">
            <img class="layer-image" src="<%= asset_path('autumn/grass_autumn.png') %>" alt="„Çπ„Çπ„Ç≠">
          </div>
        <% end %>
        
        <% if @landscape_state['osmanthus'] %>
          <div class="layer osmanthus-layer" style="display: block;">
            <img class="layer-image" src="<%= asset_path('autumn/osmanthus_autumn.png') %>" alt="ÈáëÊú®ÁäÄ">
          </div>
        <% end %>
        
        <% if @landscape_state['muscle'] %>
          <div class="layer muscle-layer" style="display: block;">
            <img class="layer-image" src="<%= asset_path('autumn/muscle_autumn.png') %>" alt="Á≠ãËÇâ">
          </div>
        <% end %>
        
        <% if @landscape_state['fire'] %>
          <div class="layer fire-layer" style="display: block;">
            <img class="layer-image" src="<%= asset_path('autumn/fire_autumn.png') %>" alt="ÁÑö„ÅçÁÅ´">
          </div>
        <% end %>
        
        <% if @landscape_state['chestnut'] %>
          <div class="layer chestnut-layer" style="display: block;">
            <img class="layer-image" src="<%= asset_path('autumn/chestnut_autumn.png') %>" alt="Ê†ó">
          </div>
        <% end %>
        
        <% if @landscape_state['sweetpotato'] %>
          <div class="layer sweetpotato-layer" style="display: block;">
            <img class="layer-image" src="<%= asset_path('autumn/sweetpotato_autumn.png') %>" alt="„Åï„Å§„Åæ„ÅÑ„ÇÇ">
          </div>
        <% end %>
        
        <% if @landscape_state['dango'] %>
          <div class="layer dango-layer" style="display: block;">
            <img class="layer-image" src="<%= asset_path('autumn/dango_autumn.png') %>" alt="„Å†„Çì„Åî">
          </div>
        <% end %>

        <% if @landscape_state['book'] %>
          <div class="layer book-layer" style="display: block;">
            <img class="layer-image" src="<%= asset_path('autumn/book_autumn.png') %>" alt="Ë™≠Êõ∏">
          </div>
        <% end %>
        
        <% if @landscape_state['acorns'] %>
          <div class="layer acorns-layer" style="display: block;">
            <img class="layer-image" src="<%= asset_path('autumn/acorns_autumn.png') %>" alt="„Å©„Çì„Åê„Çä">
          </div>
        <% end %>
        
        <% if @landscape_state['apple'] %>
          <div class="layer apple-layer" style="display: block;">
            <img class="layer-image" src="<%= asset_path('autumn/apple_autumn.png') %>" alt="„Çä„Çì„Åî">
          </div>
        <% end %>
        
        <% if @landscape_state['cat'] %>
          <div class="layer cat-layer" style="display: block;">
            <img class="layer-image" src="<%= asset_path('autumn/cat_autumn.png') %>" alt="Áå´">
          </div>
        <% end %>
        
        <% if @landscape_state['dog'] %>
          <div class="layer dog-layer" style="display: block;">
            <img class="layer-image" src="<%= asset_path('autumn/dog_autumn.png') %>" alt="Áä¨">
          </div>
        <% end %>
        
        <% if @landscape_state['fish'] %>
          <div class="layer fish-layer" style="display: block;">
            <img class="layer-image" src="<%= asset_path('autumn/fish_autumn.png') %>" alt="È≠ö">
          </div>
        <% end %>
        
        <% if @landscape_state['persimmon'] %>
          <div class="layer persimmon-layer" style="display: block;">
            <img class="layer-image" src="<%= asset_path('autumn/persimmon.png') %>" alt="Êüø">
          </div>
        <% end %>
        
        <% if @landscape_state['cosmos'] %>
          <div class="layer cosmos-layer" style="display: block;">
            <img class="layer-image" src="<%= asset_path('autumn/cosmos_autumn.png') %>" alt="„Ç≥„Çπ„É¢„Çπ">
          </div>
        <% end %>
        
        <% if @landscape_state['dragonfly'] %>
          <div class="layer dragonfly-layer" style="display: block;">
            <img class="layer-image" src="<%= asset_path('autumn/dragonfly_autumn.png') %>" alt="„Å®„Çì„Åº">
          </div>
        <% end %>
        
        <% if @landscape_state['leaves'] %>
          <div class="layer leaves-layer" style="display: block;">
            <img class="layer-image" src="<%= asset_path('autumn/leaves_autumn.png') %>" alt="ËêΩ„Å°Ëëâ">
          </div>
        <% end %>
        
        <% if @landscape_state['dahlia'] %>
          <div class="layer dahlia-layer" style="display: block;">
            <img class="layer-image" src="<%= asset_path('autumn/dahlia_autumn.png') %>" alt="„ÉÄ„É™„Ç¢">
          </div>
        <% end %>
        
        <% if @landscape_state['gentian'] %>
          <div class="layer gentian-layer" style="display: block;">
            <img class="layer-image" src="<%= asset_path('autumn/gentian_autumn.png') %>" alt="„É™„É≥„Éâ„Ç¶">
          </div>
        <% end %>
        
        <!-- ÂÆåÊàêË®òÂøµ„ÅÆ„Ç¶„Ç©„Éº„Çø„Éº„Éû„Éº„ÇØ -->
        <div class="watermark" style="position: absolute; bottom: 20px; right: 20px; background: rgba(255,255,255,0.8); padding: 10px 15px; border-radius: 10px; font-size: 14px; text-align: center; z-index: 100;">
          <p style="margin: 0; font-weight: bold; color: #333;">My Autumn World</p>
          <p style="margin: 5px 0 0 0; color: #666;"><%= Date.current.strftime("%Y.%m.%d") %></p>
        </div>
      </div>
    </div>

    <div class="button-group" style="justify-content: center; margin-top: 10px">
      <%= link_to "„ÇÇ„ÅÜ‰∏ÄÂ∫¶‰Ωú„Çã", reset_world_path(redirect_to: 'game'), class: "complete-btn", style: "text-decoration: none;" %>
      <%= link_to "„Éà„ÉÉ„Éó„Å´Êàª„Çã", root_path, class: "reset-btn", style: "text-decoration: none;" %>

      <button onclick="captureAndShare()" class="share-btn" style="background: linear-gradient(45deg, #1DA1F2, #0d8bd9); color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 14px; transition: transform 0.2s; text-decoration: none;">
      X„Åß„Ç∑„Çß„Ç¢
     </button>
    </div>
  </div>
</body>
</html>
